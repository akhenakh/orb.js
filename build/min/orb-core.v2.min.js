var Orb=Orb||{};Orb.Constant=Orb.Constant||{PI:Math.PI,RAD:Math.PI/180,AU:149597870.7,RE:6378.137,LD:384e3,LY:Number("9.46073E+12"),PC:Number("3.08568E+13"),G:Number("6.6740831E-11"),GM:2.9591220828559095*Math.pow(10,-4),Planets:["Sun","Mercury","Venus","Earth","Moon","Mars","Jupiter","Saturn","Uranus","Neptune"],Sun:{radius:696019,obliquity:7.25,mass:Number("1.989E+30"),gm:Number("1.327124400189E+11")},Mercury:{radius:2439.7,obliquity:.027,mass:Number("3.301E+23"),gm:220329},Venus:{radius:6051.8,obliquity:177.36,mass:Number("4.867E+24"),gm:3248599},Earth:{radius:6378.15,obliquity:23.435,mass:Number("5.972E+24"),gm:Number("3.9860044189E+5")},Moon:{radius:1737.4,obliquity:1.5424,mass:Number("7.346E+22"),gm:4904.86959},Mars:{radius:3397.2,obliquity:25,mass:Number("6.417E+24"),gm:42828.9},Jupiter:{radius:71492,obliquity:3.08,mass:Number("1.899E+27"),gm:1266865349},Saturn:{radius:60268,obliquity:26.7,mass:Number("5.685E+26"),gm:379311879},Uranus:{radius:25559,obliquity:97.9,mass:Number("8.682E+26"),gm:57939399},Neptune:{radius:24786,obliquity:29.6,mass:Number("1.024E+26"),gm:68365299}},Orb.Const=Orb.Constant,Orb.RoundAngle=Orb.RoundAngle||function(t){var e=t%360;return e<0&&(e+=360),e},Orb.NutationAndObliquity=Orb.NutationAndObliquity||function(t){var e=Orb.Constant.RAD,a=(new Orb.Time(t).jd()-2451545)/36525,i=(125.04452-1934.136261*a+.0020708*a*a+(a*a+a)/45e4)*e,r=(280.4665+36000.7698*a)*e,s=(218.3165+481267.8813*a)*e;return{nutation:function(){return-17.2/3600*Math.sin(i)- -1.32/3600*Math.sin(2*r)-.23/3600*Math.sin(2*s)+.21/3600*Math.sin(2*i)/e},obliquity:function(){return 23.43929111111111-46.815/3600*a-59e-5/3600*a*a+.001813/3600*a*a*a+(9.2/3600*Math.cos(i)+.57/3600*Math.cos(2*r)+.1/3600*Math.cos(2*s)-.09/3600*Math.cos(2*i))}}},Orb.Obliquity=Orb.Obliquity||function(t){return new Orb.NutationAndObliquity(t).obliquity()},Orb.Time=Orb.Time||function(t){if(t)e=t;else var e=new Date;this.date=e,this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hours=e.getUTCHours(),this.minutes=e.getUTCMinutes(),this.seconds=e.getUTCSeconds()},Orb.Time.prototype={time_in_day:function(){return this.hours/24+this.minutes/1440+this.seconds/86400},jd:function(){var t=this.year,e=this.month,a=this.day;if(e<=2)var t=t-1,e=e+12;var i=Math.floor(365.25*(t+4716))+Math.floor(30.6001*(e+1))+a-1524.5;if(i<2299160.5)s=0;else var r=Math.floor(t/100),s=2-r+Math.floor(r/4);return i+s},gmst:function(){var t=Orb.Constant.RAD,e=3600*this.hours+60*this.minutes+this.seconds,a=(this.jd()-2451545)/36525,i=(24110.5484+8640184.812866*a+.093104*a*a+62e-7*a*a*a)/3600;i>24&&(i%=24);var r=i+1.00273790925*e/3600,s=23.43929111111111-46.815/3600*a-59e-5/3600*a*a+.001813/3600*a*a*a,n=125.04452-1934.136261*a+.0020708*a*a+a*a*a/45e4,o=280.4665+36000.7698*a,u=218.3165+481267.8813*a;return(r+=(-17.2*Math.sin(n*t)- -1.32*Math.sin(2*o*t)-.23*Math.sin(2*u*t)+.21*Math.sin(2*n*t))/15*Math.cos(s*t)/3600)<0&&(r=r%24+24),r>24&&(r%=24),r},delta_t:function(){var t=this.year,e=t+(this.month-.5)/12;if(t<=-500)i=32*(r=(e-1820)/100)*r-20;else if(t>-500&&t<=500)i=10583.6-1014.41*(r=e/100)+33.78311*r*r-5.952053*r*r*r-.1798452*r*r*r*r+.022174192*r*r*r*r*r+.0090316521*r*r*r*r*r;else if(t>500&&t<=1600)i=1574.2-556.01*(r=(e-1e3)/100)+71.23472*r*r+.319781*r*r*r-.8503463*r*r*r*r-.005050998*r*r*r*r*r+.0083572073*r*r*r*r*r*r;else if(t>1600&&t<=1700)i=120-.9808*(a=e-1600)-.01532*a*a+a*a*a/7129;else if(t>1700&&t<=1800)i=8.83+.1603*(a=e-1700)-.0059285*a*a+13336e-8*a*a*a-a*a*a*a/1174e3;else if(t>1800&&t<=1860)i=13.72-.332447*(a=e-1800)+.0068612*a*a+.0041116*a*a*a-37436e-8*a*a*a*a+121272e-10*a*a*a*a*a-1.699e-7*a*a*a*a*a*a+8.75e-10*a*a*a*a*a*a*a;else if(t>1860&&t<=1900)i=7.62+.5737*(a=e-1860)-.251754*a*a+.01680668*a*a*a-.0004473624*a*a*a*a+a*a*a*a*a/233174;else if(t>1900&&t<=1920)i=1.494119*(a=e-1900)-2.79-.0598939*a*a+.0061966*a*a*a-197e-6*a*a*a*a;else if(t>1920&&t<=1941)i=21.2+.84493*(a=e-1920)-.0761*a*a+.0020936*a*a*a;else if(t>1941&&t<=1961)i=29.07+.407*(a=e-1950)-a*a/233+a*a*a/2547;else if(t>1961&&t<=1986)i=45.45+1.067*(a=e-1975)-a*a/260-a*a*a/718;else if(t>1986&&t<=2005)i=63.86+.3345*(a=e-2e3)-.060374*a*a+.0017275*a*a*a+651814e-9*a*a*a*a+2373599e-11*a*a*a*a*a;else if(t>2005&&t<=2050)var a=e-2e3,i=62.92+.32217*a+.005589*a*a;else if(t>2050&&t<=2150)i=(e-1820)/100*32*((e-1820)/100)-20-.5628*(2150-e);else if(t>2150)var r=(e-1820)/100,i=32*r*r-20;return i},doy:function(){var t=this.date,e=new Date(Date.UTC(t.getFullYear()-1,11,31,0,0,0));return((t.getTime()-t.getTimezoneOffset()-e.getTime())/864e5).toFixed(8)}},Orb.RadecToXYZ=function(t){var e=Orb.Const.RAD,a=15*t.ra,i=t.dec,r=t.distance,s={x:r*Math.cos(i*e)*Math.cos(a*e),y:r*Math.cos(i*e)*Math.sin(a*e),z:r*Math.sin(i*e)};return{x:s.x,y:s.y,z:s.z,coordinate_keywords:"equatorial rectangular",unit_keywords:""}},Orb.XYZtoRadec=function(t){if(t.coordinate_keywords&&t.coordinate_keywords.match(/ecliptic/)){if(t.date)e=t.date;else var e=new Date;a=Orb.EclipticToEquatorial({date:e,ecliptic:t})}else var a=t;var i=Math.PI/180,r=a.x,s=a.y,n=a.z,o=Math.atan2(s,r)/i;o<0&&(o=o%360+360),o>360&&(o%=360);return{ra:o/=15,dec:Math.atan2(n,Math.sqrt(r*r+s*s))/i,distance:Math.sqrt(r*r+s*s+n*n),coordinate_keywords:"equatorial spherical",unit_keywords:"hours degree"}},Orb.EquatorialToEcliptic=function(t){var e=t.date,a=Orb.Obliquity(e),i=t.equatorial,r=Orb.Const.RAD,s={x:i.x,y:Math.cos(a*r)*i.y+Math.sin(a*r)*i.z,z:-Math.sin(a*r)*i.y+Math.cos(a*r)*i.z};return{x:s.x,y:s.y,z:s.z,date:e,coordinate_keywords:"ecliptic rectangular",unit_keywords:""}},Orb.EclipticToEquatorial=function(t){var e=t.date,a=t.ecliptic,i=Orb.Const.RAD,r=new Orb.VSOP("Earth").xyz(e),s=a.x-r.x,n=a.y-r.y,o=a.z-r.z,u=Orb.Obliquity(t.date),h={x:s,y:n*Math.cos(u*i)-o*Math.sin(u*i),z:n*Math.sin(u*i)+o*Math.cos(u*i)};return{x:h.x,y:h.y,z:h.z,date:e,coordinate_keywords:"equatorial rectangular",unit_keywords:""}},Orb.Observer=Orb.Observer||function(t){var e=Orb.Constant.RAD;Math.sqrt(1-.006674372230614*Math.cos(t.latitude*e));this.latitude=t.latitude,this.longitude=t.longitude,this.altitude=t.altitude},Orb.Observer.prototype={rectangular:function(t){var e=Orb.Constant.RAD,a=this.latitude,i=this.longitude,r=15*t.gmst()+i,s=6378.135+this.altitude,n=.00335277945,o=Math.sin(a*e),u=1/Math.sqrt(1+n*(n-2)*o*o),h=(1-n)*(1-n)*u;return{x:s*u*Math.cos(a*e)*Math.cos(r*e),y:s*u*Math.cos(a*e)*Math.sin(r*e),z:s*h*Math.sin(a*e)}}},Orb.Observation=Orb.Observation||function(t){this.observer=t.observer,this.target=t.target},Orb.Observation.prototype={RadecToHorizontal:function(t,e){var a=Orb.Constant.RAD,i=this.observer,r=Number(e.ra),s=Number(e.dec);if(void 0!=e.distance)n=Number(e.distance);else var n=void 0;var o=Number(i.latitude),u=Number(i.longitude);Number(i.altitutude);s*=a;var h=(15*t.gmst()+u-15*r)*a,c=o*a,d=Math.atan2(-Math.cos(s)*Math.sin(h),Math.sin(s)*Math.cos(c)-Math.cos(s)*Math.sin(c)*Math.cos(h))/a,l=Math.asin(Math.sin(s)*Math.sin(c)+Math.cos(c)*Math.cos(s)*Math.cos(h))/a;return d<0&&(d=d%360+360),{azimuth:d,elevation:l,distance:n}},RectToHorizontal:function(t,e){var a=Orb.Constant.RAD,i=this.observer,r=i.latitude,s=i.longitude,n=new Orb.Observer(i).rectangular(t),o=e.x-n.x,u=e.y-n.y,h=e.z-n.z,c=15*t.gmst()+s,d=Math.sin(r*a)*Math.cos(c*a)*o+Math.sin(r*a)*Math.sin(c*a)*u-Math.cos(r*a)*h,l=-Math.sin(c*a)*o+Math.cos(c*a)*u,b=Math.cos(r*a)*Math.cos(c*a)*o+Math.cos(r*a)*Math.sin(c*a)*u+Math.sin(r*a)*h,M=Math.sqrt(d*d+l*l+b*b),m=Math.asin(b/M),y=Math.atan2(-l,d);return(y=y/a+180)>360&&(y%=360),{azimuth:y,elevation:m,distance:M}},azel:function(t){function e(t){return t.unit_keywords.match(/km/)?"km":t.unit_keywords.match(/au/)?"au":void 0}Orb.Constant.RAD;var a=this.target,i=(this.observer,new Orb.Time(t));if(void 0!=a.ra&&void 0!=a.dec)var r=this.RadecToHorizontal(i,a),s="au";else if(void 0!=a.x&&void 0!=a.y&&void 0!=a.z){if(a.coordinate_keywords.match(/ecliptic/)){if(void 0!=a.date)n=a.date;else var n=t;u=Orb.EclipticToEquatorial({date:n,ecliptic:a})}else u=a;var r=this.RectToHorizontal(i,u),s=e(u)}else if(void 0!=a.radec)var o=a.radec(t),r=this.RadecToHorizontal(i,o),s=e(o);else if(void 0!=a.xyz)var u=a.xyz(t),r=this.RectToHorizontal(i,u),s=e(u);return{azimuth:r.azimuth,elevation:r.elevation,distance:r.distance,date:t,coordinate_keywords:"horizontal spherical",unit_keywords:"degree "+s}}};