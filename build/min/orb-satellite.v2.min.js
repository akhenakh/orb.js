Orb.SGP4=Orb.SGP4||function(t){this.tle=t,this.orbital_elements=this.DecodeTLE(),this.sgp4=this.SetSGP4(),this.orbital_period=this.sgp4.orbital_period,this.apogee=this.sgp4.apogee,this.perigee=this.sgp4.perigee},Orb.SGP4.prototype={DecodeTLE:function(){var t=this.tle,e=t.name,o=t.first_line,a=t.second_line,i=Number(o.slice(18,20));if(i<57)var r=i+2e3;else r=i+1900;var s=1e-5*Number(o.substring(53,59)),n=Number("1e"+Number(o.substring(59,61))),c=s*n;return{name:e,line_number_1:Number(o.slice(0,0)),catalog_no_1:Number(o.slice(2,6)),security_classification:Number(o.slice(7,7)),international_identification:Number(o.slice(9,17)),epoch_year:r,epoch:Number(o.substring(20,32)),first_derivative_mean_motion:Number(o.substring(33,43)),second_derivative_mean_motion:Number(o.substring(44,52)),bstar_mantissa:s,bstar_exponent:n,bstar:c,ephemeris_type:Number(o.substring(62,63)),element_number:Number(o.substring(64,68)),check_sum_1:Number(o.substring(69,69)),line_number_2:Number(o.slice(0,0)),catalog_no_2:Number(a.slice(2,7)),inclination:Number(a.substring(8,16)),right_ascension:Number(a.substring(17,25)),eccentricity:Number(a.substring(26,33)),argument_of_perigee:Number(a.substring(34,42)),mean_anomaly:Number(a.substring(43,51)),mean_motion:Number(a.substring(52,63)),rev_number_at_epoch:Number(a.substring(64,68)),check_sum_2:Number(o.substring(68,69))}},SetSGP4:function(){var t=this.orbital_elements,e=Math.PI/180,o=541308e-9,a=.66666667,i=.0743669161,r=6378.135,s=t.epoch,n=t.epoch_year,c=t.bstar,h=t.inclination*e,m=t.right_ascension*e,u=1e-7*t.eccentricity,b=t.argument_of_perigee*e,l=t.mean_anomaly*e,d=2*t.mean_motion*Math.PI/1440,_=Math.pow(i/d,a),g=Math.cos(h),p=g*g,M=3*p-1,x=1-u*u,f=Math.sqrt(x),y=1.5*o*M/(_*_*f*x),v=_*(1-y*(1/3+y*(1+134/81*y))),N=1.5*o*M/(v*v*f*x),k=d/(1+N),w=v/(1-N),P=1440/Number(t.mean_motion),S=0;w*(1-u)<220/r+1&&(S=1);var G=1.01222928,O=1.88027916e-9,q=(w*(1-u)-1)*r,z=(w*(1+u)-1)*r;if(q<156)if(G=q-78,q<=98)G=20;else{O=Math.pow((120-G)/r,4);G=G/r+1}var T=1/(w*w*x*x),D=1/(w-G),E=w*u*D,C=E*E,I=u*E,R=Math.abs(1-C),A=O*Math.pow(D,4),L=A/Math.pow(R,3.5),U=c*(L*k*(w*(1+1.5*C+I*(4+C))+.75*o*D/R*M*(8+3*C*(8+C)))),j=Math.sin(h),B=253881e-11/o*Math.pow(1,3),F=A*D*B*k*1*j/u,H=1-p,J=2*k*L*w*x*(E*(2+.5*C)+u*(.5+2*C)-2*o*D/(w*R)*(-3*M*(1-2*I+C*(1.5-.5*I))+.75*H*(2*C-I*(1+C))*Math.cos(2*b))),K=2*L*w*x*(1+2.75*(C+I)+I*C),Q=p*p,V=3*o*T*k,W=V*o*T,X=1.25*6.2098875e-7*T*T*k,Y=-V*g,Z=.125*B*j*(3+5*g)/(1+g),$=.25*B*j;if(1!=S)var tt=U*U,et=4*w*D*tt,ot=et*D*U/3,at=(17*w+G)*ot,it=.5*ot*w*D*(221*w+31*G)*U,rt=et+2*tt,st=.25*(3*at+U*(12*et+10*tt)),nt=.2*(3*it+12*U*at+6*et*et+15*tt*(2*et+tt));return{orbital_elements:t,apogee:z,perigee:q,orbital_period:P,epoch_year:n,epoch:s,xmo:l,xmdot:k+.5*V*f*M+.0625*W*f*(13-78*p+137*Q),omegao:b,omgdot:-.5*V*(1-5*p)+.0625*W*(7-114*p+395*Q)+X*(3-36*p+49*Q),xnodeo:m,xnodot:Y+(.5*W*(4-19*p)+2*X*(3-7*p))*g,xnodcf:3.5*x*Y*U,bstar:c,t2cof:1.5*U,omgcof:c*F*Math.cos(b),isimp:S,xmcof:-a*A*c*1/I,eta:E,delmo:Math.pow(1+E*Math.cos(l),3),c1:U,c4:J,c5:K,d2:et,d3:at,d4:it,sinmo:Math.sin(l),t3cof:rt,t4cof:st,t5cof:nt,aodp:w,eo:u,xnodp:k,xke:i,xlcof:Z,aycof:$,x3thm1:M,x1mth2:H,xincl:h,cosio:g,sinio:j,e6a:1e-6,ck2:o,x7thm1:7*p-1,xkmper:r}},ExecSGP4:function(t){Orb.Constant.RAD;var e,o,a,i=this.sgp4,r=this.orbital_elements,s=(e=r.epoch_year,o=r.epoch,a=e-1,(Date.UTC(t.year,t.month-1,t.day,t.hours,t.minutes,t.seconds,t.milliseconds)-(Date.UTC(a,11,31,0,0,0)+24*o*60*60*1e3))/6e4),n=i.xmo,c=i.xmdot,h=i.omegao,m=i.omgdot,u=i.xnodeo,b=i.xnodot,l=i.xnodcf,d=i.bstar,_=i.t2cof,g=i.omgcof,p=i.isimp,M=i.xmcof,x=i.eta,f=i.delmo,y=i.c1,v=i.c4,N=i.c5,k=i.d2,w=i.d3,P=i.d4,S=i.sinmo,G=i.t3cof,O=i.t4cof,q=i.t5cof,z=i.aodp,T=i.eo,D=i.xnodp,E=i.xke,C=i.xlcof,I=i.aycof,R=i.x3thm1,A=i.x1mth2,L=i.xincl,U=i.cosio,j=i.sinio,B=i.e6a,F=i.ck2,H=i.x7thm1,J=i.xkmper,K=(i.epoch_year,i.epoch,n+c*s),Q=h+m*s,V=Q,W=K,X=s*s,Y=u+b*s+l*X,Z=1-y*s,$=d*v*s,tt=_*X;if(1!=p){W=K+(Tt=g*s+M*(Math.pow(1+x*Math.cos(K),3)-f)),V=Q-Tt;var et=X*s,ot=s*et;Z=Z-k*X-w*et-P*ot,$=$+d*N*(Math.sin(W)-S),tt=tt+G*et+ot*(O+s*q)}for(var at=z*Z*Z,it=T-$,rt=W+V+Y+D*tt,st=Math.sqrt(1-it*it),nt=E/Math.pow(at,1.5),ct=it*Math.cos(V),ht=(Tt=1/(at*st*st))*I,mt=rt+Tt*C*ct,ut=it*Math.sin(V)+ht,bt=(mt-Y)%(2*Math.PI),lt=bt,dt=1;dt<=10;dt++){var _t=Math.sin(lt),gt=Math.cos(lt),pt=ut*gt,Mt=ct*gt,xt=ut*_t,ft=(bt-pt+(yt=ct*_t)-lt)/(1-Mt-xt)+lt;if(Math.abs(ft-lt)<=B)break;lt=ft}var yt,vt=yt-pt,Nt=at*(Tt=1-(ct*ct+ut*ut)),kt=at*(1-(Mt+xt)),wt=1/kt,Pt=E*Math.sqrt(at)*vt*wt,St=E*Math.sqrt(Nt)*wt,Gt=(lt=at*wt,Math.sqrt(Tt)),Ot=lt*(gt-ct+ut*vt*(yt=1/(1+Gt))),qt=lt*(_t-ut-ct*vt*yt),zt=Math.atan2(qt,Ot);zt<0&&(zt+=2*Math.PI);var Tt,Dt=2*qt*Ot,Et=2*Ot*Ot-1,Ct=kt*(1-1.5*(lt=(wt=F*(Tt=1/Nt))*Tt)*Gt*R)+.5*wt*A*Et,It=zt-.25*lt*H*Dt,Rt=Y+1.5*lt*U*Dt,At=L+1.5*lt*U*j*Et,Lt=Pt-nt*wt*A*Dt,Ut=St+nt*wt*(A*Et+1.5*R),jt=Math.sin(It),Bt=Math.cos(It),Ft=Math.sin(At),Ht=Math.cos(At),Jt=Math.sin(Rt),Kt=Math.cos(Rt),Qt=-Jt*Ht,Vt=Kt*Ht,Wt=Qt*jt+Kt*Bt,Xt=Vt*jt+Jt*Bt,Yt=Ft*jt;return{x:Ct*Wt*J,y:Ct*Xt*J,z:Ct*Yt*J,xdot:(Lt*Wt+Ut*(Qt*Bt-Kt*jt))*J/60,ydot:(Lt*Xt+Ut*(Vt*Bt-Jt*jt))*J/60,zdot:(Lt*Yt+Ut*(Ft*Bt))*J/60}},RectangularToGeographic:function(t,e){t=t;var o=e.x,a=e.y,i=e.z,r=e.xdot,s=e.ydot,n=e.zdot,c=Orb.Constant.RAD,h=15*t.gmst(),m=.00335277945,u=Math.sqrt(o*o+a*a),b=Math.atan2(a,o)/c-h;360<b&&(b%=360),b<0&&(b=b%360+360),180<b&&(b-=360);var l=Math.atan2(i,u),d=m*(2-m),_=0;do{_=l;var g=Math.sin(_),p=1/Math.sqrt(1-d*g*g);l=Math.atan2(i+6378.135*p*d*Math.sin(_),u)}while(1e-4<Math.abs(l-_));return{longitude:b,latitude:l/c,altitude:u/Math.cos(l)-6378.135*p,velocity:Math.sqrt(r*r+s*s+n*n)}},xyz:function(t){var e=new Orb.Time(t),o=this.ExecSGP4(e);return{x:o.x,y:o.y,z:o.z,xdot:o.xdot,ydot:o.ydot,zdot:o.zdot,date:t,coordinate_keywords:"equational rectangular",unit_keywords:"km"}},latlng:function(t){var e=new Orb.Time(t),o=this.ExecSGP4(e),a=this.RectangularToGeographic(e,o);return{latitude:a.latitude,longitude:a.longitude,altitude:a.altitude,velocity:a.velocity,date:t,coordinate_keywords:"geographic spherical",unit_keywords:"degree km"}}},Orb.Satellite=Orb.Satellite||Orb.SGP4;