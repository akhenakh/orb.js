var Orb;(Orb=Orb||{}).Storage=Orb.Storage||{},Orb.Constant=Orb.Constant||{PI:Math.PI,RAD:Math.PI/180,AU:149597870.7,RE:6378.137,LD:384e3,LY:Number("9.46073E+12"),PC:Number("3.08568E+13"),G:Number("6.6740831E-11"),GM:2.9591220828559095*Math.pow(10,-4),Planets:["Sun","Mercury","Venus","Earth","Moon","Mars","Jupiter","Saturn","Uranus","Neptune"],Sun:{radius:696019,obliquity:7.25,mass:Number("1.989E+30"),gm:Number("1.327124400189E+11")},Mercury:{radius:2439.7,obliquity:.027,mass:Number("3.301E+23"),gm:220329},Venus:{radius:6051.8,obliquity:177.36,mass:Number("4.867E+24"),gm:3248599},Earth:{radius:6378.15,obliquity:23.435,mass:Number("5.972E+24"),gm:Number("3.9860044189E+5")},Moon:{radius:1737.4,obliquity:1.5424,mass:Number("7.346E+22"),gm:4904.86959},Mars:{radius:3397.2,obliquity:25,mass:Number("6.417E+24"),gm:42828.9},Jupiter:{radius:71492,obliquity:3.08,mass:Number("1.899E+27"),gm:1266865349},Saturn:{radius:60268,obliquity:26.7,mass:Number("5.685E+26"),gm:379311879},Uranus:{radius:25559,obliquity:97.9,mass:Number("8.682E+26"),gm:57939399},Neptune:{radius:24786,obliquity:29.6,mass:Number("1.024E+26"),gm:68365299}},Orb.Const=Orb.Constant,Orb.RoundAngle=Orb.RoundAngle||function(t){var a=t%360;return a<0&&(a+=360),a},Orb.NutationAndObliquity=Orb.NutationAndObliquity||function(t){var a=Orb.Constant.RAD,r=(new Orb.Time(t).jd()-2451545)/36525,e=(125.04452-1934.136261*r+.0020708*r*r+(r*r+r)/45e4)*a,i=(280.4665+36000.7698*r)*a,n=(218.3165+481267.8813*r)*a;return{nutation:function(){return-17.2/3600*Math.sin(e)- -1.32/3600*Math.sin(2*i)-.23/3600*Math.sin(2*n)+.21/3600*Math.sin(2*e)/a},obliquity:function(){return 23.43929111111111-46.815/3600*r-59e-5/3600*r*r+.001813/3600*r*r*r+(9.2/3600*Math.cos(e)+.57/3600*Math.cos(2*i)+.1/3600*Math.cos(2*n)-.09/3600*Math.cos(2*e))}}},Orb.Obliquity=Orb.Obliquity||function(t){return new Orb.NutationAndObliquity(t).obliquity()},Orb.Time=Orb.Time||function(t){if(t)a=t;else var a=new Date;var r=function(t){return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hours:t.getUTCHours(),minutes:t.getUTCMinutes(),seconds:t.getUTCSeconds()}}(a),e=function(){return r.hours/24+r.minutes/1440+r.seconds/86400},i=function(){var t=r.year,a=r.month,e=r.day;if(a<=2)var t=t-1,a=a+12;var i=Math.floor(365.25*(t+4716))+Math.floor(30.6001*(a+1))+e-1524.5;if(i<2299160.5)o=0;else var n=Math.floor(t/100),o=2-n+Math.floor(n/4);return i+o};return{date:a,year:Number(r.year),month:Number(r.month),day:Number(r.day),hours:Number(r.hours),minutes:Number(r.minutes),seconds:Number(r.seconds),time_in_day:function(){return e()},jd:function(){return i()+e()},gmst:function(){return function(){var t=Orb.Constant.RAD,a=3600*r.hours+60*r.minutes+r.seconds,e=(i()-2451545)/36525,n=(24110.5484+8640184.812866*e+.093104*e*e+62e-7*e*e*e)/3600;n>24&&(n%=24);var o=n+1.00273790925*a/3600,u=23.43929111111111-46.815/3600*e-59e-5/3600*e*e+.001813/3600*e*e*e,s=125.04452-1934.136261*e+.0020708*e*e+e*e*e/45e4,c=280.4665+36000.7698*e,d=218.3165+481267.8813*e;return(o+=(-17.2*Math.sin(s*t)- -1.32*Math.sin(2*c*t)-.23*Math.sin(2*d*t)+.21*Math.sin(2*s*t))/15*Math.cos(u*t)/3600)<0&&(o=o%24+24),o>24&&(o%=24),o}()},doy:function(){return function(){var t=a,r=new Date(Date.UTC(t.getFullYear()-1,11,31,0,0,0));return((t.getTime()-t.getTimezoneOffset()-r.getTime())/864e5).toFixed(8)}()}}},Orb.RadecToXYZ=function(t){var a=Orb.Const.RAD,r=15*t.ra,e=t.dec,i=t.distance,n={x:i*Math.cos(e*a)*Math.cos(r*a),y:i*Math.cos(e*a)*Math.sin(r*a),z:i*Math.sin(e*a)};return{x:n.x,y:n.y,z:n.z,coordinate_keywords:"equatorial rectangular",unit_keywords:""}},Orb.XYZtoRadec=function(t){if(t.coordinate_keywords&&t.coordinate_keywords.match(/ecliptic/)){if(t.date)a=t.date;else var a=new Date;r=Orb.EclipticToEquatorial({date:a,ecliptic:t})}else var r=t;var e=Math.PI/180,i=r.x,n=r.y,o=r.z,u=Math.atan2(n,i)/e;u<0&&(u=u%360+360),u>360&&(u%=360);return{ra:u/=15,dec:Math.atan2(o,Math.sqrt(i*i+n*n))/e,distance:Math.sqrt(i*i+n*n+o*o),coordinate_keywords:"equatorial spherical",unit_keywords:"hours degree"}},Orb.EquatorialToEcliptic=function(t){var a=t.date,r=Orb.Obliquity(a),e=t.equatorial,i=Orb.Const.RAD,n={x:e.x,y:Math.cos(r*i)*e.y+Math.sin(r*i)*e.z,z:-Math.sin(r*i)*e.y+Math.cos(r*i)*e.z};return{x:n.x,y:n.y,z:n.z,date:a,coordinate_keywords:"ecliptic rectangular",unit_keywords:""}},Orb.EclipticToEquatorial=function(t){var a=t.date,r=t.ecliptic,e=Orb.Const.RAD,i=new Orb.VSOP("Earth").xyz(a),n=r.x-i.x,o=r.y-i.y,u=r.z-i.z,s=Orb.Obliquity(t.date),c={x:n,y:o*Math.cos(s*e)-u*Math.sin(s*e),z:o*Math.sin(s*e)+u*Math.cos(s*e)};return{x:c.x,y:c.y,z:c.z,date:a,coordinate_keywords:"equatorial rectangular",unit_keywords:""}},Orb.Observer=Orb.Observer||function(t){var a=Orb.Constant.RAD;Math.sqrt(1-.006674372230614*Math.cos(t.latitude*a));return{latitude:t.latitude,longitude:t.longitude,altitude:t.altitude,rectangular:function(r){var e=t.latitude,i=t.longitude,n=15*r.gmst()+i,o=6378.135,u=.00335277945,s=Math.sin(e*a),c=1/Math.sqrt(1+u*(u-2)*s*s),d=(1-u)*(1-u)*c;return{x:o*c*Math.cos(e*a)*Math.cos(n*a),y:o*c*Math.cos(e*a)*Math.sin(n*a),z:o*d*Math.sin(e*a)}}}},Orb.Observation=Orb.Observation||function(t){var a=t.observer,r=t.target,e=Orb.Constant.RAD,i=function(t,a,r){var i=Number(a.ra),n=Number(a.dec);if(void 0!=a.distance)o=Number(a.distance);else var o=void 0;var u=Number(r.latitude),s=Number(r.longitude);Number(r.altitutude);n*=e;var c=(15*t.gmst()+s-15*i)*e,d=u*e,h=Math.atan2(-Math.cos(n)*Math.sin(c),Math.sin(n)*Math.cos(d)-Math.cos(n)*Math.sin(d)*Math.cos(c))/e,b=Math.asin(Math.sin(n)*Math.sin(d)+Math.cos(d)*Math.cos(n)*Math.cos(c))/e;return h<0&&(h=h%360+360),{azimuth:h,elevation:b,distance:o}},n=function(t,a,r){var i=r.latitude,n=r.longitude,o=new Orb.Observer(r).rectangular(t),u=a.x-o.x,s=a.y-o.y,c=a.z-o.z,d=15*t.gmst()+n,h=Math.sin(i*e)*Math.cos(d*e)*u+Math.sin(i*e)*Math.sin(d*e)*s-Math.cos(i*e)*c,b=-Math.sin(d*e)*u+Math.cos(d*e)*s,l=Math.cos(i*e)*Math.cos(d*e)*u+Math.cos(i*e)*Math.sin(d*e)*s+Math.sin(i*e)*c,M=Math.sqrt(h*h+b*b+l*l),m=Math.asin(l/M),y=Math.atan2(-b,h);return(y=y/e+180)>360&&(y%=360),{azimuth:y,elevation:m,distance:M}};return{azel:function(t){return function(t){function e(t){return t.unit_keywords.match(/km/)?"km":t.unit_keywords.match(/au/)?"au":void 0}var o=new Orb.Time(t);if(void 0!=r.ra&&void 0!=r.dec)var u=i(o,r,a),s="au";else if(void 0!=r.x&&void 0!=r.y&&void 0!=r.z){if(r.coordinate_keywords.match(/ecliptic/)){if(void 0!=r.date)c=r.date;else var c=t;h=Orb.EclipticToEquatorial({date:c,ecliptic:r})}else h=r;var u=n(o,h,a),s=e(h)}else if(void 0!=r.radec)var d=r.radec(t),u=i(o,d,a),s=e(d);else if(void 0!=r.xyz)var h=r.xyz(t),u=n(o,h,a),s=e(h);return{azimuth:u.azimuth,elevation:u.elevation,distance:u.distance,date:t,coodinate_origin:"Earth",coordinate_keywords:"horizontal spherical",unit_keywords:"degree "+s}}(t)}}};